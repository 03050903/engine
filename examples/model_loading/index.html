<!doctype html>
<html>
<head>
    <script src="/engine/build/output/playcanvas-latest.js"></script>
    <style>
        html, body {
            margin: 0px;
            padding: 0px;
            overflow: hidden;
        }
        canvas: {
            display: block;
        }
    </style>
</head>

<body>
    <!-- The canvas element -->
    <canvas id="application-canvas"></canvas>

    <!-- The script -->
    <script>
        var canvas = document.getElementById("application-canvas");

        // Create the application and start the update loop
        var application = new pc.fw.Application(canvas);
        application.start();

        // Set the canvas to fill the window and automatically change resolution to be the same as the canvas size
        application.setCanvasFillMode(pc.fw.FillMode.FILL_WINDOW);
        application.setCanvasResolution(pc.fw.ResolutionMode.AUTO);

        application.context.scene.ambientLight = new pc.Color(0.2, 0.2, 0.2);

        var modelAsset = new pc.asset.Asset("Gem", "model", {
            filename: "gem2.json",
            url: "../assets/model/gem2.json",
        });

        var model, light, camera;

        application.context.assets.load(modelAsset).then(function (resource) {
            // Create a Entity with a Box model component
            model = new pc.fw.Entity();
            application.context.systems.model.addComponent(model, {
                type: "asset",
                asset: modelAsset.resourceId
            });

            // Create an Entity with a point light component and a sphere model component.
            light = new pc.fw.Entity();
            application.context.systems.light.addComponent(light, {
                type: "point",
                color: new pc.Color(1, 1,1),
                radius: 100
            });

            application.context.systems.model.addComponent(light, {
                type: "sphere"
            });

            // Scale the sphere down to 0.1m
            light.setLocalScale(0.1, 0.1, 0.1);

            // Create an Entity with a camera component
            camera = new pc.fw.Entity();
            application.context.systems.camera.addComponent(camera, {
                clearColor: new pc.Color(0.2, 0.2, 0.2)
            });

            // Add the new Entities to the hierarchy
            application.context.root.addChild(model);
            application.context.root.addChild(light);
            application.context.root.addChild(camera);

            // Move the camera 10m along the z-axis
            camera.translate(0, 0, 1);
        });

        // Set an update function on the application's update event
        var angle = 0;
        application.on("update", function (dt) {
            angle += dt;
            if (angle > 360) {
                angle = 0;
            }

            if (light && model) {
                // Move the light in a circle
                light.setLocalPosition(3 * Math.sin(angle), 0, 3 * Math.cos(angle));

                // Rotate the model
                model.rotate(0, 10*dt, 0);
            }

        });
    </script>
</body>
</html>
